<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Page Builder Journey: A Developer's Story</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="story-container">
        <header class="story-header">
            <h1>Page Builder Inline Editing Guide</h1>
            <p class="subtitle">A Technical Guide to Component Development</p>
        </header>

        <!-- Chapter Navigation Menu -->
        <nav class="chapter-nav">
            <div class="nav-container">
                <h3>Topics</h3>
                <div class="chapter-buttons">
                    <button class="chapter-nav-btn active" onclick="showChapter(1)" data-chapter="1">
                        <span class="chapter-num">1</span>
                        <span class="chapter-title">Basic Components</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(2)" data-chapter="2">
                        <span class="chapter-num">2</span>
                        <span class="chapter-title">Inline Editing Basics</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(3)" data-chapter="3">
                        <span class="chapter-num">3</span>
                        <span class="chapter-title">Data-sq-field Attributes</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(4)" data-chapter="4">
                        <span class="chapter-num">4</span>
                        <span class="chapter-title">Conditional Rendering</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(5)" data-chapter="5">
                        <span class="chapter-num">5</span>
                        <span class="chapter-title">Edit Mode Detection</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(6)" data-chapter="6">
                        <span class="chapter-num">6</span>
                        <span class="chapter-title">Complex Data Structures</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showChapter(7)" data-chapter="7">
                        <span class="chapter-num">7</span>
                        <span class="chapter-title">Best Practices</span>
                    </button>
                    <button class="chapter-nav-btn" onclick="showCheatSheet()" data-chapter="cheat">
                        <span class="chapter-num">üìã</span>
                        <span class="chapter-title">Reference</span>
                    </button>
                </div>
            </div>
        </nav>

        <div class="story-content">
            <!-- Chapter 1: Basic Components -->
            <section class="chapter" id="chapter-1">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 1</span>
                    <h2>Basic Component Structure</h2>
                </div>
                
                <div class="narrative">
                    <p>Traditional components output HTML directly without consideration for content editing interfaces. This approach works for static content but limits editorial flexibility.</p>
                    
                    <div class="code-example">
                        <div class="code-header">
                            <span class="filename">basic-component.js</span>
                            <span class="mode-indicator basic">Standard Output</span>
                        </div>
                        <pre><code class="language-javascript">export default {
    async main(args, info) {
        const { title } = args;

        return `&lt;h1&gt;${title}&lt;/h1&gt;`;
    }
}</code></pre>
                    </div>
                    
                    <p class="insight">This implementation provides clean front-end output but offers no inline editing capabilities for content editors.</p>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(7)" disabled>
                        ‚Üê Previous
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(2)">
                        Next: Inline Editing Basics ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 2: Inline Editing Basics -->
            <section class="chapter hidden" id="chapter-2">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 2</span>
                    <h2>Inline Editing Fundamentals</h2>
                </div>
                
                <div class="narrative">
                    <p>Page Builder's Visual Editor enables content authors to edit components directly in the preview interface. This requires specific implementation patterns to support both editing and front-end modes.</p>
                    
                    <div class="revelation-box">
                        <h3>üéØ Core Requirements for Inline Editing</h3>
                        <ol>
                            <li><strong>Data Attributes:</strong> Add <code>data-sq-field</code> attributes to editable elements</li>
                            <li><strong>Mode Detection:</strong> Differentiate between edit and front-end rendering</li>
                            <li><strong>Placeholder Content:</strong> Always render editable elements, even when empty</li>
                        </ol>
                    </div>

                    <div class="interactive-demo">
                        <h4>Mode Comparison: Toggle between front-end and edit modes</h4>
                        <div class="mode-switcher">
                            <button class="mode-btn active" onclick="switchMode('frontend')">Front-end Mode</button>
                            <button class="mode-btn" onclick="switchMode('edit')">Edit Mode</button>
                        </div>
                        
                        <div class="demo-output" id="demo-output">
                            <h1>Welcome to Our Amazing Site</h1>
                        </div>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(1)">
                        ‚Üê Previous: Basic Components
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(3)">
                        Next: Data-sq-field Attributes ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 3: Data-sq-field Attributes -->
            <section class="chapter hidden" id="chapter-3">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 3</span>
                    <h2>Data-sq-field Implementation</h2>
                </div>
                
                <div class="narrative">
                    <p>The <code>data-sq-field</code> attribute creates the mapping between HTML elements and the component's input schema, enabling inline editing functionality.</p>
                    
                    <div class="code-comparison">
                        <div class="code-example">
                            <div class="code-header">
                                <span class="filename">inline-editable-component.js</span>
                                <span class="mode-indicator enhanced">With Inline Editing</span>
                            </div>
                            <pre><code class="language-javascript">export default {
    async main(args, info) {
        const { title } = args;

        return `&lt;h1 data-sq-field="title"&gt;${title}&lt;/h1&gt;`;
    }
}</code></pre>
                        </div>
                        
                        <div class="explanation">
                            <h4>üîç Implementation Details</h4>
                            <ul>
                                <li><code>data-sq-field="title"</code> maps to the input schema field</li>
                                <li>Attribute path must match manifest.json structure exactly</li>
                                <li>Enables click-to-edit functionality in Page Builder</li>
                            </ul>
                        </div>
                    </div>

                    <div class="manifest-example">
                        <h4>üìã Corresponding Manifest Configuration</h4>
                        <pre><code class="language-json">"properties": {
    "title": {
        "type": "string",
        "title": "Title",
        "ui:metadata": {
            "inlineEditable": true
        }
    }
}</code></pre>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(2)">
                        ‚Üê Previous: Inline Editing Basics
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(4)">
                        Next: Conditional Rendering ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 4: Conditional Rendering -->
            <section class="chapter hidden" id="chapter-4">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 4</span>
                    <h2>Conditional Rendering Patterns</h2>
                </div>
                
                <div class="narrative">
                    <p>Components must handle scenarios where content may be empty while maintaining editability. This requires different rendering logic for edit and front-end modes.</p>
                    
                    <div class="problem-solution">
                        <div class="problem">
                            <h4>‚ùå Problematic Implementation</h4>
                            <pre><code class="language-javascript">// Element disappears when empty
${title ? `&lt;h1&gt;${title}&lt;/h1&gt;` : ''}</code></pre>
                            <p class="warning">If title is empty, the element is not rendered and cannot be edited inline.</p>
                        </div>
                        
                        <div class="solution">
                            <h4>‚úÖ Correct Implementation</h4>
                            <pre><code class="language-javascript">// Mode-aware conditional rendering
const editMode = info?.ctx?.editor;

${title ? `&lt;h1&gt;${title}&lt;/h1&gt;` : 
  editMode ? `&lt;h1 data-sq-field="title"&gt;Add a title&lt;/h1&gt;` : ''}</code></pre>
                        </div>
                    </div>

                    <div class="interactive-example">
                        <h4>üéÆ Interactive Demonstration</h4>
                        <div class="controls">
                            <label>
                                <input type="checkbox" id="has-title" checked onchange="updateConditionalDemo()"> 
                                Content Present
                            </label>
                            <label>
                                <input type="checkbox" id="is-edit-mode" onchange="updateConditionalDemo()"> 
                                Edit Mode Active
                            </label>
                        </div>
                        <div class="demo-result" id="conditional-demo">
                            <h1>Sample Title</h1>
                        </div>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(3)">
                        ‚Üê Previous: Data-sq-field Attributes
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(5)">
                        Next: Edit Mode Detection ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 5: Edit Mode Detection -->
            <section class="chapter hidden" id="chapter-5">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 5</span>
                    <h2>Edit Mode Detection</h2>
                </div>
                
                <div class="narrative">
                    <p>The component context object provides access to the editor state, enabling components to render differently based on the current mode.</p>
                    
                    <div class="code-example advanced">
                        <div class="code-header">
                            <span class="filename">context-aware-component.js</span>
                            <span class="mode-indicator advanced">Context-Aware</span>
                        </div>
                        <pre><code class="language-javascript">export default {
    async main(args, info) {
        const { title } = args;
        
        // Access editor state from context
        const editMode = info?.ctx?.editor;

        const frontendOutput = `${title ? `&lt;h1&gt;${title}&lt;/h1&gt;` : ''}`;
        
        const editOutput = `&lt;h1 data-sq-field="title"&gt;${title || 'Add a title'}&lt;/h1&gt;`;
        
        return `
            &lt;section data-component="my-component"&gt;
                ${editMode ? editOutput : frontendOutput}
            &lt;/section&gt;
        `;
    }
}</code></pre>
                    </div>

                    <div class="key-insights">
                        <h4>üîë Technical Implementation Notes</h4>
                        <div class="insight-grid">
                            <div class="insight-card">
                                <h5>Context Access</h5>
                                <p>Use <code>info.ctx</code> to access component execution context including editor state</p>
                            </div>
                            <div class="insight-card">
                                <h5>Editor Detection</h5>
                                <p><code>ctx.editor</code> returns boolean indicating current rendering mode</p>
                            </div>
                            <div class="insight-card">
                                <h5>Fallback Content</h5>
                                <p>Provide meaningful placeholder text for empty fields in edit mode</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(4)">
                        ‚Üê Previous: Conditional Rendering
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(6)">
                        Next: Complex Data Structures ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 6: Complex Data Structures -->
            <section class="chapter hidden" id="chapter-6">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 6</span>
                    <h2>Complex Data Structure Handling</h2>
                </div>
                
                <div class="narrative">
                    <p>Advanced components often work with nested objects, arrays, and complex field types. These require specific attribute path syntax and careful handling of empty states.</p>
                    
                    <div class="complex-example">
                        <h4>üèóÔ∏è Implementation Example</h4>
                        <div class="tabs">
                            <button class="tab-btn active" onclick="showTab('manifest')">Manifest Schema</button>
                            <button class="tab-btn" onclick="showTab('component')">Component Logic</button>
                            <button class="tab-btn" onclick="showTab('output')">Rendered Output</button>
                        </div>
                        
                        <div class="tab-content active" id="manifest-tab">
                            <pre><code class="language-json">{
  "properties": {
    "content": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "ui:metadata": { "inlineEditable": true }
        },
        "features": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string", "ui:metadata": { "inlineEditable": true } },
              "description": { "type": "string", "ui:metadata": { "inlineEditable": true } }
            }
          }
        }
      }
    },
    "config": {
      "type": "object",
      "properties": {
        "theme": {
          "type": "string",
          "enum": ["light", "dark"],
          "ui:metadata": { "quickOption": true }
        }
      }
    }
  }
}</code></pre>
                        </div>
                        
                        <div class="tab-content" id="component-tab">
                            <pre><code class="language-javascript">export default {
    async main(args, info) {
        const { content = {}, config = {} } = args;
        const { title = '', features = [] } = content;
        const { theme = 'light' } = config;
        
        const editMode = info?.ctx?.editor;
        
        const renderFeatures = () => {
            if (features.length === 0 && editMode) {
                return `&lt;div data-sq-field="content.features"&gt;
                    &lt;p&gt;Click to add features&lt;/p&gt;
                &lt;/div&gt;`;
            }
            
            return features.map((feature, index) =&gt; `
                &lt;div class="feature" data-sq-field="content.features[${index}]"&gt;
                    &lt;h3 data-sq-field="content.features[${index}].title"&gt;
                        ${feature.title || (editMode ? 'Add feature title' : '')}
                    &lt;/h3&gt;
                    &lt;p data-sq-field="content.features[${index}].description"&gt;
                        ${feature.description || (editMode ? 'Add description' : '')}
                    &lt;/p&gt;
                &lt;/div&gt;
            `).join('');
        };
        
        return `
            &lt;section class="component theme-${theme}"&gt;
                ${editMode 
                    ? `&lt;h1 data-sq-field="content.title"&gt;${title || 'Add your title'}&lt;/h1&gt;`
                    : title ? `&lt;h1&gt;${title}&lt;/h1&gt;` : ''
                }
                &lt;div class="features"&gt;
                    ${renderFeatures()}
                &lt;/div&gt;
            &lt;/section&gt;
        `;
    }
};</code></pre>
                        </div>
                        
                        <div class="tab-content" id="output-tab">
                            <div class="output-demo">
                                <div class="component theme-light">
                                    <h1 data-sq-field="content.title">Amazing Features</h1>
                                    <div class="features">
                                        <div class="feature" data-sq-field="content.features[0]">
                                            <h3 data-sq-field="content.features[0].title">Fast Performance</h3>
                                            <p data-sq-field="content.features[0].description">Lightning-fast loading times</p>
                                        </div>
                                        <div class="feature" data-sq-field="content.features[1]">
                                            <h3 data-sq-field="content.features[1].title">Easy to Use</h3>
                                            <p data-sq-field="content.features[1].description">Intuitive interface design</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="critical-rules">
                        <h4>‚ö†Ô∏è Critical Implementation Rules</h4>
                        <ul>
                            <li><strong>Array indexing:</strong> Use <code>[${index}]</code> syntax in data-sq-field paths</li>
                            <li><strong>Array joining:</strong> Always use <code>.join('')</code> with <code>.map()</code> operations</li>
                            <li><strong>Empty state handling:</strong> Render placeholder elements for empty arrays in edit mode</li>
                        </ul>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(5)">
                        ‚Üê Previous: Edit Mode Detection
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(7)">
                        Next: Best Practices ‚Üí
                    </button>
                </div>
            </section>

            <!-- Chapter 7: Best Practices -->
            <section class="chapter hidden" id="chapter-7">
                <div class="chapter-header">
                    <span class="chapter-number">Chapter 7</span>
                    <h2>Development Best Practices</h2>
                </div>
                
                <div class="narrative">
                    <p>Effective Page Builder component development requires adherence to established patterns and consideration of both editorial and front-end user experiences.</p>
                    
                    <div class="wisdom-cards">
                        <div class="wisdom-card">
                            <div class="wisdom-icon">üéØ</div>
                            <h4>Core Implementation Rules</h4>
                            <ul>
                                <li>Always detect edit mode using <code>ctx.editor</code></li>
                                <li>Map <code>data-sq-field</code> paths to manifest structure exactly</li>
                                <li>Provide placeholder content for empty fields in edit mode</li>
                                <li>Use <code>.join('')</code> when rendering arrays with <code>.map()</code></li>
                            </ul>
                        </div>
                        
                        <div class="wisdom-card">
                            <h4>üîß Field Type Guidelines</h4>
                            <div class="comparison-table">
                                <div class="comparison-row">
                                    <div class="comparison-label">Quick Options</div>
                                    <div class="comparison-value">Configuration, themes, boolean toggles</div>
                                </div>
                                <div class="comparison-row">
                                    <div class="comparison-label">Inline Editing</div>
                                    <div class="comparison-value">Content fields, text, images, links</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="wisdom-card">
                            <div class="wisdom-icon">‚ö°</div>
                            <h4>Performance Considerations</h4>
                            <ul>
                                <li>Separate edit and front-end rendering when necessary</li>
                                <li>Implement meaningful defaults to prevent errors</li>
                                <li>Handle malformed or missing data gracefully</li>
                                <li>Test both rendering modes thoroughly</li>
                            </ul>
                        </div>
                    </div>

                    <div class="final-example">
                        <h4>üèÜ Complete Implementation Template</h4>
                        <pre><code class="language-javascript">import { html } from '../../utils/html';

export default {
    async main(args, info) {
        // 1. Extract and validate inputs with defaults
        const { content = {}, config = {} } = args || {};
        const { title = '', description = '' } = content;
        const { theme = 'light' } = config;
        
        // 2. Detect edit mode using context
        const editMode = info?.ctx?.editor;
        
        // 3. Render based on mode
        if (editMode) {
            return html`
                &lt;section class="component theme-${theme}"&gt;
                    &lt;h1 data-sq-field="content.title"&gt;${title || 'Add your title'}&lt;/h1&gt;
                    &lt;p data-sq-field="content.description"&gt;${description || 'Add description'}&lt;/p&gt;
                &lt;/section&gt;
            `;
        } else {
            return html`
                &lt;section class="component theme-${theme}"&gt;
                    ${title ? html`&lt;h1&gt;${title}&lt;/h1&gt;` : ''}
                    ${description ? html`&lt;p&gt;${description}&lt;/p&gt;` : ''}
                &lt;/section&gt;
            `;
        }
    }
};</code></pre>
                    </div>
                </div>

                <div class="story-conclusion">
                    <h3>üéØ Implementation Summary</h3>
                    <p>Effective Page Builder components balance editorial flexibility with clean front-end output. By implementing proper edit mode detection and data-sq-field mapping, components provide intuitive editing experiences while maintaining optimal performance.</p>
                    
                    <div class="call-to-action">
                        <h4>Continue Your Development Journey</h4>
                        <button class="cta-button" onclick="restartStory()">Review Topics</button>
                        <button class="cta-button secondary" onclick="showCheatSheet()">View Reference</button>
                    </div>
                </div>

                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(6)">
                        ‚Üê Previous: Complex Data Structures
                    </button>
                    <button class="nav-btn next-btn" onclick="showCheatSheet()">
                        View Reference ‚Üí
                    </button>
                </div>
            </section>

            <!-- Reference Guide -->
            <section class="chapter hidden" id="cheat-sheet">
                <div class="chapter-header">
                    <span class="chapter-number">üìã</span>
                    <h2>Technical Reference</h2>
                </div>
                
                <div class="cheat-sheet-content">
                    <div class="cheat-section">
                        <h4>Essential Imports</h4>
                        <pre><code class="language-javascript">import { html } from '../../utils/html';
// Note: No longer need isEditor import!</code></pre>
                    </div>
                    
                    <div class="cheat-section">
                        <h4>Edit Mode Detection</h4>
                        <pre><code class="language-javascript">// Current implementation
const editMode = info?.ctx?.editor;</code></pre>
                    </div>
                    
                    <div class="cheat-section">
                        <h4>Data-sq-field Patterns</h4>
                        <pre><code class="language-javascript">// Simple field
data-sq-field="title"

// Nested object
data-sq-field="content.title"

// Array item
data-sq-field="items[${index}].title"</code></pre>
                    </div>
                    
                    <div class="cheat-section">
                        <h4>Conditional Rendering</h4>
                        <pre><code class="language-javascript">${editMode 
  ? html`&lt;h1 data-sq-field="title"&gt;${title || 'Add title'}&lt;/h1&gt;`
  : title ? html`&lt;h1&gt;${title}&lt;/h1&gt;` : ''
}</code></pre>
                    </div>
                    
                    <div class="cheat-section">
                        <h4>Array Rendering</h4>
                        <pre><code class="language-javascript">${items.map((item, index) => html`
  &lt;div data-sq-field="items[${index}]"&gt;
    &lt;h3 data-sq-field="items[${index}].title"&gt;${item.title}&lt;/h3&gt;
  &lt;/div&gt;
`).join('')}</code></pre>
                    </div>
                </div>
                
                <div class="chapter-navigation">
                    <button class="nav-btn prev-btn" onclick="showChapter(7)">
                        ‚Üê Back to Best Practices
                    </button>
                    <button class="nav-btn next-btn" onclick="showChapter(1)">
                        Review Topics ‚Üí
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 